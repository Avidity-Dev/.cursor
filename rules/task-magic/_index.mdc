---
description: 
globs: 
alwaysApply: true
---
# Task Magic System Overview

Whenever you use this rule, start your message with the following:

"Accessing Task Magic system overview..."

**üéØ Index Purpose**: This rule is **always included** and serves as your **rule dispatcher** - it guides you to fetch the specific rules you need based on user requests and detected conditions.

Task Magic consists of **TWO distinct but complementary parts**:

1. **The Project Management System** (`.ai/` directory) - A tool-agnostic, file-based project management framework for organizing projects, tasks, plans, and memory
2. **The AI Agent Rules** (`.cursor/rules/task-magic/` directory) - Cursor-specific instructions that teach AI agents how to operate the project management system

## System Architecture

### The .ai/ Project Management System

A structured, tool-agnostic directory system for managing multiple projects:

```
.ai/
  projects/
    {project-name}/
      plan.md         # Project PRD
      tasks/          # Active tasks for this project
        task{id}_name.md
      TASKS.md        # Project task checklist
      context/        # Additional project context
  memory/             # Global archive (shared across projects)
    tasks/            # Archived task files from all projects
    plans/            # Archived plan files from all projects
    TASKS_LOG.md      # Global task archive log
    PLANS_LOG.md      # Global plan archive log
  INDEX.md            # Global project registry
```

### The .cursor/rules/task-magic/ Rules System

Cursor-specific rules that teach agents how to use the .ai/ system:

- `tasks.mdc` - Task creation, management, and lifecycle
- `plan.mdc` - PRD creation and planning workflows  
- `memory.mdc` - Archival and historical context management
- `expand.mdc` - Task complexity assessment and sub-task creation
- `handoff.mdc` - Context transfer between AI sessions
- `legacy.mdc` - Migration guide from legacy to enhanced system

## üö® CRITICAL: When to Fetch Each Rule

**NEVER work with Task Magic files without fetching the appropriate rule first!**

- **üö® MUST FETCH `@tasks.mdc` BEFORE**:
  - Creating, updating, or modifying any file in `.ai/projects/{project}/tasks/` 
  - Updating `.ai/projects/{project}/TASKS.md`
  - Changing task status, adding timestamps, or working with task IDs
  - **Contains required procedures**: date command for timestamps, YAML format, file naming conventions, dependency checking

- **üö® MUST FETCH `@plan.mdc` BEFORE**:
  - Creating or updating any PRD files in `.ai/projects/{project}/plan.md`
  - Working with project plans or feature context documents

- **üö® MUST FETCH `@memory.mdc` BEFORE**:
  - Archiving tasks from `.ai/projects/{project}/tasks/` to `.ai/memory/tasks/`
  - Working with `.ai/memory/TASKS_LOG.md` or `.ai/memory/PLANS_LOG.md`

- **üö® MUST FETCH `@expand.mdc` BEFORE**:
  - Determining if a task should be broken into sub-tasks
  - Creating sub-task structures

- **üö® MUST FETCH `@handoff.mdc` (or `task-magic/handoff.mdc`) BEFORE**:
  - Creating or interpreting handoff files in `.ai/handoffs/`
  - Transferring task context between sessions using the handoff mechanism

- **üö® MUST FETCH `@legacy.mdc` WHEN**:
  - **Detecting legacy structure**: `.ai/tasks/`, `.ai/TASKS.md`, `.ai/plans/PLAN.md`, or `.ai/plans/features/` exist
  - **User requests migration**: upgrading from old to new Task Magic system
  - **Mixed structure found**: both legacy and new files present
  - **Purpose**: Provides migration guidance to upgrade to enhanced project-scoped system

## Legacy System Detection

**üîç Automatic Detection Triggers:**
If you encounter any of these, immediately fetch `@legacy.mdc`:
- `.ai/tasks/` directory exists (instead of `.ai/projects/{project}/tasks/`)
- `.ai/TASKS.md` file exists (instead of `.ai/projects/{project}/TASKS.md`)
- `.ai/plans/PLAN.md` file exists (instead of `.ai/projects/{project}/plan.md`)
- `.ai/plans/features/` directory exists (instead of `.ai/projects/{project}/context/`)
- No `.ai/projects/` directory structure present
- No `.ai/INDEX.md` registry file

**Agent Response**: When legacy detected, inform user about enhanced system benefits and offer migration using the legacy rule.

## System Components (Rules Explanation)

1.  **Plans (`@plan.mdc`)**:
    *   **Purpose**: Defines how Product Requirements Documents (PRDs) are created and structured for projects.
    *   **Location**: Each project has its own `plan.md` at `.ai/projects/{project}/plan.md`
    *   **Key Registry**: Global `.ai/INDEX.md` maintains discovery of all project plans
    *   **Details**: For plan creation, fully review [task-magic/plan.mdc](mdc:.cursor/rules/task-magic/plan.mdc)

2.  **Tasks (`@tasks.mdc`)**:
    *   **Purpose**: Governs the creation, management, and lifecycle of individual development tasks within projects.
    *   **Active Tasks**: Each project's active tasks reside in `.ai/projects/{project}/tasks/` as `task{id}_name.md` files.
    *   **Master View**: Each project has a checklist at `.ai/projects/{project}/TASKS.md` that mirrors the status of tasks in that project's tasks directory.
    *   **Details**: For task creation, fully review [task-magic/tasks.mdc](mdc:.cursor/rules/task-magic/tasks.mdc)

3.  **Memory (`@memory.mdc`)**:
    *   **Purpose**: Archives completed and failed tasks and plans to provide historical context across all projects.
    *   **Location**: Archived files from all projects are stored in the global `.ai/memory/` directory.
    *   **Log Files**: Chronological logs are maintained in `.ai/memory/TASKS_LOG.md` and `.ai/memory/PLANS_LOG.md`.
    *   **Details**: For archival workflows, fully review [task-magic/memory.mdc](mdc:.cursor/rules/task-magic/memory.mdc)

4.  **Handoffs (`@handoff.mdc` or `task-magic/handoff.mdc`)**:
    *   **Purpose**: Facilitates context transfer between AI sessions for specific tasks or projects.
    *   **Location**: Handoff files are stored in `.ai/handoffs/`.
    *   **Details**: For creating and using handoff files, review [task-magic/handoff.mdc](mdc:.cursor/rules/task-magic/handoff.mdc)

5.  **Legacy Migration (`@legacy.mdc`)**:
    *   **Purpose**: Provides comprehensive guidance for upgrading from legacy single-directory Task Magic to enhanced project-scoped system.
    *   **Trigger**: Use when detecting legacy structures or user requests migration.
    *   **Focus**: Migration process, not legacy system usage - helps users upgrade to new system.
    *   **Details**: For migration workflows, fully review [task-magic/legacy.mdc](mdc:.cursor/rules/task-magic/legacy.mdc)

## Key Distinctions

- **Tool Agnostic**: The `.ai/` directory structure can be used by any AI assistant, human developer, or development tool
- **Cursor Specific**: The `.cursor/rules/task-magic/` files are specific instructions for Cursor's AI on how to operate the system
- **Multi-Project**: The enhanced system supports multiple isolated projects with shared memory for cross-project learning
- **Migration Ready**: Legacy detection and upgrade guidance built into the system

This interconnected system allows for structured project development across multiple projects, from high-level planning to task execution and historical review, primarily managed through Markdown files and defined agent responsibilities.